function showText(t,e){let s=0,a="";for(let e of t.innerText)a+="<span>"+e+"</span>";t.innerHTML=a,setTimeout(()=>{let e=setInterval(()=>{t.children[s++].style.opacity="1",s>=t.children.length&&this.clearInterval(e)},100)},e)}function typeText(){let t=0,e=0,s=!0;setInterval(()=>{e>=0?textBox.innerText=s?content[t].substring(0,++e):content[t].substring(0,e--):e--,e>=content[t].length+8&&(s=!1),e<-10&&(t++,s=!0,e=0,t>=content.length&&(t=0))},150)}function canvasRender(){function t(){for(let t=0;t<canvasSettings.star1Nums;t++)s.push(i(-o/2,o/2),i(-height/2,height/2));for(let t=0;t<canvasSettings.star2Nums;t++)a.push(i(-o/2,o/2),i(-height/2,height/2));for(let t=0;t<canvasSettings.star3Nums;t++)n.push(new h(i(-o/2,o/2),i(-height/2,height/2)))}function e(){ctx.clearRect(-o/2-25,-height/2-25,o+50,height+50),ctx.beginPath(),ctx.rotate(2e-4);for(let t=0;t<s.length-1;t+=2)ctx.beginPath(),ctx.fillStyle="#fff",ctx.arc(s[t],s[t+1],.5,0,2*Math.PI),ctx.fill(),ctx.closePath();for(let t=0;t<canvasSettings.star2Nums/10;t++)for(let e=0;e<10;e+=2)ctx.beginPath(),ctx.fillStyle=r[t],ctx.arc(s[10*t+e],s[10*t+e+1],1,0,2*Math.PI),ctx.fill(),ctx.closePath();n.forEach(t=>t.draw()),ctx.closePath(),aniFrameID=window.requestAnimationFrame(e)}let s=[],a=[],r=["#fff","#fff","#1a96fc","#b542fd","#e8ae02"],n=[],o=height=skySize;const i=(t,e)=>Math.round(Math.random()*(e-t)+t);canvas_sky.width=canvas_sky.height=skySize,ctx.translate(skySize/2,skySize/2);class h{constructor(t,e){this.x=t,this.y=e,this.radius=mobile?1:2,this.angle=2*Math.random()*Math.PI,this.h=Math.random()>.5?[216,"#1a96fc"]:[277,"#b700ff"],this.color=`hsla(${this.h[0]}, 100%, 50%, ${Math.abs(Math.sin(this.angle))})`}draw(){this.flash(),ctx.beginPath(),ctx.shadowOffsetX=3,ctx.shadowOffsetY=3,ctx.shadowBlur=12,ctx.shadowColor=this.h[1],ctx.fillStyle=this.color,ctx.arc(this.x,this.y,this.radius,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.shadowOffsetX=-3,ctx.shadowOffsetY=-3,ctx.shadowBlur=12,ctx.shadowColor=this.h[1],ctx.fillStyle=this.color,ctx.arc(this.x,this.y,this.radius,0,2*Math.PI),ctx.fill(),ctx.closePath()}flash(){this.angle+=.01,this.color=`hsla(${this.h[0]}, 100%, 50%, ${Math.abs(Math.sin(this.angle))})`}}t(),e(),renderInfo.innerText="Canvas"}function innerStar(){let t=2*Math.PI*Math.random(),e=Math.round(15*Math.sin(t)),s=Math.round(15*Math.cos(t));starsDOM+="<span class='twinkle_star1'></span>",starsDOM+=`<span class='twinkle_star2' style='top:${50+e}%;left:${50+s}%;'></span>`,starsDOM+=`<span class='twinkle_star3' style='top:${50-e}%;left:${50-s}%;'></span>`}function PCLoadStar(){for(let t=0;t<starsNums.star1Nums;t++)starsDOM+="<span class='star1 "+flashArray[getRandomIndex(4)]+"' style='transform:translate("+Math.random()*skySize+"px,"+Math.random()*skySize+"px);'></span>";for(let t=0;t<starsNums.star2Nums;t++)starsDOM+="<span class='star2 "+star2Color[t%star2Color.length]+" "+flashArray[getRandomIndex(4)]+"' style='transform:translate("+Math.random()*skySize+"px,"+Math.random()*skySize+"px);'></span>";for(let t=0;t<starsNums.star3Nums;t++)starsDOM+="<span class='star3 "+star3color[getRandomIndex(4)]+" "+flashArray[getRandomIndex(4)]+"' style='transform:translate("+Math.random()*skySize+"px,"+Math.random()*skySize+"px);'></span>";renderInfo.innerText="Dom"}function mobileLoadStar(){for(let t=0;t<starsNums.starsInCenter;t++)starsDOM+="<span class='star1 "+flashArray[getRandomIndex(4)]+"' style='transform:translate("+Math.random()*skySize+"px,"+Math.random()*skySize+"px);'></span>";for(let t=0;t<starsNums.star1Nums;t++)starsDOM+="<span class='star1 "+(()=>t%2==0?flashArray[getRandomIndex(4)]:"")()+"' style='transform:translate("+Math.random()*skySize+"px,"+Math.random()*skySize+"px);'></span>";for(let t=0;t<starsNums.star2Nums;t++)starsDOM+="<span class='star2 "+star2Color[t%star2Color.length]+" "+flashArray[getRandomIndex(4)]+"' style='transform:translate("+Math.random()*skySize+"px,"+Math.random()*skySize+"px);'></span>";for(let t=0;t<starsNums.star3Nums;t++)starsDOM+="<span class='star3 "+star3color[getRandomIndex(4)]+" "+flashArray[getRandomIndex(4)]+"' style='transform:translate("+Math.random()*skySize+"px,"+Math.random()*skySize+"px);'></span>";renderInfo.innerText="Dom"}function shootingStar(){function t(){e.top<=page2Height?(e.fall(),requestAnimationFrame(t)):page2.removeChild(e.meteorDom)}let e=new Metor;e.init(),t()}function loadPage2(){main.style.top="-100vh",initPage2(),loadStar(),innerStar(),meteorTimer=setInterval(()=>{Math.random()>.8&&shootingStar()},5e3),typeText(),sky.innerHTML=starsDOM}function initPage2(){new Promise(t=>{canvas.removeEventListener("mousedown",mousedownAct),canvas.removeEventListener("mousemove",mousemoveAct),canvas.removeEventListener("mouseup",mouseupAct),canvas.removeEventListener("touchstart",touchstartAct),canvas.removeEventListener("touchmove",touchmoveAct,!1),canvas.removeEventListener("touchend",touchendAct),setTimeout(()=>{t()},500)}).then(()=>{canvas_fluid.parentNode.removeChild(canvas_fluid)})}const mobile=navigator.userAgent.toLowerCase().match(/(mobile|android|phone|iphone|pad|ipod|MQQBrowser|JUC|coolpad|mmp|smartphone|midp|wap|xoom|symbian|j2me|blackberry|wince|windows Phone)/i),main=document.querySelector(".main"),door=document.querySelector(".door"),webTitle=document.querySelector(".webTitle"),subtitle=document.querySelector(".subtitle"),canvas_sky=document.getElementById("canvas_sky"),ctx=canvas_sky.getContext("2d"),page2=document.querySelector(".page2"),textBox=document.querySelector(".textBox"),verse=document.querySelector(".verse"),sky=document.querySelector(".sky"),BgSwitch=document.getElementById("BgSwitch"),renderInfo=document.querySelector(".renderInfo"),flashArray=["flash1","flash2","flash3","flash4"],verseContent=["我们都生活在阴沟里，仍有人仰望星空","如果你瞄准月亮，即使迷失也是落在星河之间","月亮踩碎星光，我们都是藏于银河的幻想","春光恰与少年同，十里清风慕天青"],content=["技术&生活&分享&回忆","欢迎来到SHIWIVI的网站","推荐使用PC端谷歌浏览器访问","移动端下CSS样式会被阉割","服务器在国外,加载会有亿点点慢"];let meteorTimer=0,aniFrameID=0,starsDOM="",page2Width=page2.offsetWidth,page2Height=page2.offsetHeight;const getRandomIndex=t=>Math.floor(Math.random()*t),getRandomNum=(t,e)=>Math.random()*(e-t)+t;window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFram||window.mozRequestAnimationFram||window.oRequestAnimationFram||window.msRequestAnimationFram||function(t){window.setTimeout(t,1e3/60)};let settings={PC:{offsetStar:-150,offsetScreen:0,skySize:Math.sqrt(Math.pow(page2Width,2)+Math.pow(page2Height,2)),star2Color:["star2_white","star2_white","star2_white","star2_white","star2_blue","star2_purple","star2_orange"],star3color:["star3_white","star3_white","star3_purple","star3_blue"],loadStar:PCLoadStar,starsNums:{star1Nums:400,star2Nums:200,star3Nums:100},canvasSettings:{star1Nums:400,star2Nums:50,star3Nums:20}},mobile:{offsetStar:600,offsetScreen:200,skySize:page2Height,star2Color:["star2_white","star2_white","star2_blue","star2_purple","star2_orange"],star3color:["star3_white","star3_purple","star3_blue"],loadStar:mobileLoadStar,starsNums:{starsInCenter:5,star1Nums:130,star2Nums:20,star3Nums:15},canvasSettings:{star1Nums:180,star2Nums:50,star3Nums:10}}},{offsetStar:offsetStar,offsetScreen:offsetScreen,skySize:skySize,star2Color:star2Color,star3color:star3color,loadStar:loadStar,starsNums:starsNums,canvasSettings:canvasSettings}=mobile?settings.mobile:settings.PC;class Metor{constructor(){this.top=-300,this.width=parseInt(200*Math.random()+800),this.right=-(Math.random()*(page2Width+offsetScreen)+offsetStar),this.meteorDom=document.createElement("div")}init(){this.meteorDom.className="meteor",this.meteorDom.style.width=this.width+"px",this.meteorDom.style.right=this.right+"px",this.meteorDom.style.top=this.top+"px",page2.appendChild(this.meteorDom)}fall(){this.top+=20,this.right+=20,this.meteorDom.style.right=this.right+"px",this.meteorDom.style.top=this.top+"px"}}new Promise(t=>{function e(s){("click"==s.type||s.deltaY>0)&&(loadPage2(),t(e))}door.addEventListener("click",e),main.addEventListener("wheel",e)}).then(t=>{main.removeEventListener("wheel",t),door.removeEventListener("click",t)}),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState?document.title="这个页面会占用很多内存哦":(document.title="",setTimeout(function(){document.title="SHIWIVI"},3e3))}),BgSwitch.addEventListener("click",()=>{0==BgSwitch.checked?(sky.innerHTML="",starsDOM=[],canvasRender(),innerStar(),sky.innerHTML=starsDOM):(sky.innerHTML="",starsDOM=[],window.cancelAnimationFrame(aniFrameID),ctx.clearRect(-skySize/2,-skySize/2,skySize,skySize),loadStar(),innerStar(),sky.innerHTML=starsDOM)}),document.addEventListener("readystatechange",t=>{"interactive"===t.target.readyState&&(sky.style.width=sky.style.height=skySize+"px",page2.style.height=window.innerHeight+"px")}),window.addEventListener("load",()=>{showText(webTitle,100),showText(subtitle,800),verse.innerText=verseContent[Math.round(Math.random()*(verseContent.length-1))]});